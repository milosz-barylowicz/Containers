name: clang-format

on:
  push:
    branches: [ '**' ]
  pull_request:
    branches: [ '**' ]
  workflow_dispatch:
    inputs:
      chosen-os:
        required: true
        type: choice
        default: ubuntu-22.04
        options:
        - ubuntu-22.04
        - macos-12

jobs:
   code-format:
    runs-on: [ "${{ github.event_name == 'push' && 'ubuntu-22.04' || inputs.chosen-os }}" ]

    steps:
    - uses: actions/checkout@v4.1.1

    - name: configuring git
      run: git config --global user.email "${{ secrets.EMAIL }}" && git config --global user.name "${{ secrets.AGENT_NAME }}"

    - name: formatting code
      run: ./scripts/run_clang_format.sh

    - name: commiting changes
      run: ./.github/workflows/scripts/commit_changes.sh
